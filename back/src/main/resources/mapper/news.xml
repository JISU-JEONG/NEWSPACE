<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.news">

	<select id="getNews" resultType="com.ssafy.edu.dto.NewsDTO"
		parameterType="java.lang.Integer">
		select * from news where NEWS_ID = #{news_id}
	</select>

	<select id="getNewsOne" resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news WHERE URL
		like #{url}
	</select>

	<insert id="addNews" parameterType="com.ssafy.edu.dto.NewsDTO">
		insert into news(title, date,
		body, brand, category, keyword, url, bodytext) values (#{title},
		#{date},
		#{body}, #{brand}, #{category}, #{keyword}, #{url},
		#{bodytext})
	</insert>

	<select id="getSamsungNews"
		resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where brand like "SAMSUNG" order by date
		desc
	</select>

	<select id="getLgNews" resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where brand
		like "LG" order by date desc
	</select>

	<select id="getSkNews" resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where brand
		like "SK" order by date desc
	</select>

	<select id="getSamsungRecent"
		resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where brand like "SAMSUNG" order by date
		desc limit 20
	</select>

	<select id="getLgRecent" resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where
		brand like "LG" order by date desc limit 20
	</select>

	<select id="getSkRecent" resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where
		brand like "SK" order by date desc limit 20
	</select>

	<insert id="addNewsKeyword"
		parameterType="com.ssafy.edu.help.NewsKeyword">
		insert into newskeyword(news_id, keyword)
		VALUES(#{news_id}, #{keyword})
	</insert>

	<select id="newsKeywordValid" parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.help.NewsKeyword">
		select * from newskeyword where NEWS_ID = #{news_id}
	</select>

	<update id="updateNewsKeyword"
		parameterType="com.ssafy.edu.help.NewsKeyword">
		update newskeyword set KEYWORD = #{keyword} where
		NEWS_ID = #{news_id}
	</update>

	<select id="findNewsAll"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM news n JOIN newskeyword k
		WHERE
		n.NEWS_ID = k.NEWS_ID
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					n.TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		) ORDER BY DATE DESC
	</select>

	<select id="findNewsSamsung"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM news n JOIN newskeyword k
		WHERE
		n.NEWS_ID = k.NEWS_ID
		AND BRAND LIKE #{brand}
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					n.TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		) ORDER BY DATE DESC
	</select>

	<select id="findNewsLg"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM news n JOIN newskeyword k
		WHERE
		n.NEWS_ID = k.NEWS_ID
		AND BRAND LIKE #{brand}
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					n.TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		) ORDER BY DATE DESC
	</select>

	<select id="findNewsSk"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM news n JOIN newskeyword k
		WHERE
		n.NEWS_ID = k.NEWS_ID
		AND BRAND LIKE #{brand}
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					n.TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		) ORDER BY DATE DESC
	</select>

	<select id="getAllNews" resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news
	</select>

	<select id="getAllNewsRecent"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM news ORDER BY DATE DESC LIMIT 50
	</select>

	<select id="getNewsKeywordAll"
		resultType="com.ssafy.edu.help.NewsKeyword">
		SELECT * FROM newskeyword
	</select>

	<select id="getKeywordNews"
		resultType="com.ssafy.edu.dto.NewsDTO"
		parameterType="com.ssafy.edu.help.NewsSearch">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM news n JOIN newskeyword k
		WHERE
		n.NEWS_ID = k.NEWS_ID
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		) AND n.DATE >= DATE_SUB(NOW(), INTERVAL 31 DAY) ORDER BY n.DATE DESC
	</select>

	<select id="getMeberNews" parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.dto.NewsDTO">
		select * from news where news_id in (SELECT news_news_id from amt.member_news
		where member_member_id = #{member_id});
	</select>

</mapper>
