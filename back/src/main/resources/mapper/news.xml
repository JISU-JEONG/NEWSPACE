<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.news">

	<select id="getNews" resultType="com.ssafy.edu.dto.NewsDTO"
		parameterType="java.lang.Integer">
		SELECT * FROM NEWS WHERE NEWS_ID = #{news_id}
	</select>

	<select id="getNewsOne" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE URL
		LIKE #{url}
	</select>

	<insert id="addNews" parameterType="com.ssafy.edu.dto.NewsDTO">
		INSERT INTO NEWS(title, date,
		body, brand, category, keyword, url, bodytext) VALUES (#{title},
		#{date},
		#{body}, #{brand}, #{category}, #{keyword}, #{url},
		#{bodytext})
	</insert>

	<select id="getSamsungNews"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE BRAND LIKE "SAMSUNG" ORDER BY DATE
		DESC
	</select>

	<select id="getLgNews" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE BRAND
		LIKE "LG" ORDER BY DATE DESC
	</select>

	<select id="getSkNews" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE BRAND
		LIKE "SK" ORDER BY DATE DESC
	</select>

	<select id="getSamsungRecent"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE BRAND LIKE "SAMSUNG" ORDER BY DATE
		DESC LIMIT 20
	</select>

	<select id="getLgRecent" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE
		BRAND LIKE "LG" ORDER BY DATE DESC LIMIT 20
	</select>

	<select id="getSkRecent" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS WHERE
		BRAND LIKE "SK" ORDER BY DATE DESC LIMIT 20
	</select>

	<select id="getNewsCountSamsung" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM
		NEWS WHERE BRAND LIKE "SAMSUNG"
	</select>

	<select id="getNewsKeywordSamsung" resultType="java.lang.String">
		SELECT KEYWORD
		FROM NEWS WHERE BRAND LIKE "SAMSUNG"
	</select>

	<insert id="addNewsKeyword"
		parameterType="com.ssafy.edu.help.NewsKeyword">
		INSERT INTO NEWSKEYWORD(news_id, keyword)
		VALUES(#{news_id}, #{keyword})
	</insert>

	<select id="newsKeywordValid" parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.help.NewsKeyword">
		SELECT * FROM NEWSKEYWORD WHERE NEWS_ID = #{news_id}
	</select>

	<update id="updateNewsKeyword"
		parameterType="com.ssafy.edu.help.NewsKeyword">
		UPDATE NEWSKEYWORD SET KEYWORD = #{keyword} WHERE
		NEWS_ID = #{news_id}
	</update>

	<select id="findNewsSamsung"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM NEWS n JOIN NEWSKEYWORD k
		WHERE n.NEWS_ID = k.NEWS_ID
		AND BRAND LIKE #{brand}
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE #{word}
				</foreach>
				)
			</when>
		</choose>
		)
	</select>

	<select id="findNewsLg"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM NEWS n JOIN NEWSKEYWORD k
		WHERE n.NEWS_ID = k.NEWS_ID
		AND BRAND LIKE #{brand}
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE #{word}
				</foreach>
				)
			</when>
		</choose>
		)
	</select>

	<select id="findNewsSk"
		parameterType="com.ssafy.edu.help.NewsSearch"
		resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT n.NEWS_ID, n.TITLE, n.DATE, n.BODY, n.BRAND, n.CATEGORY,
		k.KEYWORD, n.URL, n.BODYTEXT
		FROM NEWS n JOIN NEWSKEYWORD k
		WHERE n.NEWS_ID = k.NEWS_ID
		AND BRAND LIKE #{brand}
		AND (
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="AND ">
					TITLE LIKE CONCAT('%',#{word},'%')
				</foreach>
				)
			</when>
		</choose>
		OR
		<choose>
			<when test="search.length != 0">
				(
				<foreach collection="search" item="word" index="index"
					separator="OR ">
					k.KEYWORD LIKE #{word}
				</foreach>
				)
			</when>
		</choose>
		)
	</select>
	
	<select id="getAllNews" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS
	</select>
	
	<select id="getAllNewsRecent" resultType="com.ssafy.edu.dto.NewsDTO">
		SELECT * FROM NEWS ORDER BY DATE DESC LIMIT 50
	</select>
	
</mapper>
